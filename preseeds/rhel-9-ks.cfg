#version=RHEL9
# System authorization information
auth --enableshadow --passalgo=sha512

# Use CDROM installation media
cdrom

# Use text install
text

# Run the Setup Agent on first boot
firstboot --disable

# Keyboard layouts
keyboard --vckeymap=us --xlayouts='us'

# System language
lang en_US.UTF-8

# Network information
network  --bootproto=dhcp --device=eth0 --ipv6=auto --activate
network  --hostname=rhel9-mail-server

# Root password (WhiteSnake8587)
rootpw --iscrypted $6$rounds=4096$saltsalt$3GjLb.xoOJUUBs6q1xPQB7bLPjh7f2FqPi8VhZqC9vK8LqP3N6kX8F9HVm2hPYqJ7xqL8mN9pQ1rS2tU3vW4x/

# User creation
user --groups=wheel --name=mailtest --password=$6$rounds=4096$saltsalt$3GjLb.xoOJUUBs6q1xPQB7bLPjh7f2FqPi8VhZqC9vK8LqP3N6kX8F9HVm2hPYqJ7xqL8mN9pQ1rS2tU3vW4x/ --iscrypted --gecos="Mail Test User"

# System timezone
timezone America/New_York --isUtc

# System bootloader configuration
bootloader --location=mbr

# Partition clearing information
clearpart --all --initlabel

# Disk partitioning information
autopart --type=lvm

# SELinux configuration (disabled for Mail Server Factory)
selinux --disabled

# Firewall configuration
firewall --disabled

# Reboot after installation
reboot

%packages
@^server-product-environment
@base
@core
docker
docker-compose
openssh-server
net-tools
curl
wget
vim
%end

%post --log=/root/ks-post.log
# Enable services
systemctl enable sshd
systemctl enable docker

# Configure sudo for mailtest user
echo "mailtest ALL=(ALL) NOPASSWD: ALL" >> /etc/sudoers.d/mailtest
chmod 0440 /etc/sudoers.d/mailtest

# Add mailtest to docker group
usermod -aG docker mailtest

# Enable password authentication for SSH
sed -i 's/PasswordAuthentication no/PasswordAuthentication yes/' /etc/ssh/sshd_config

# Disable SELinux
sed -i 's/SELINUX=enforcing/SELINUX=disabled/' /etc/selinux/config
%end
